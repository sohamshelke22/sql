CREATE TABLE Employee (
    emp_id INT PRIMARY KEY,
    employee_name VARCHAR(50) NOT NULL UNIQUE,
    street VARCHAR(100),
    city VARCHAR(50)
);

CREATE TABLE Company (
    company_name VARCHAR(50) PRIMARY KEY,
    city VARCHAR(50) NOT NULL
);

CREATE TABLE Works (
    employee_name VARCHAR(50),
    company_name VARCHAR(50),
    salary DECIMAL(10,2),
    FOREIGN KEY (employee_name) REFERENCES Employee(employee_name),
    FOREIGN KEY (company_name) REFERENCES Company(company_name)
);

CREATE TABLE Manages (
    employee_name VARCHAR(50),
    manager_name VARCHAR(50),
    FOREIGN KEY (employee_name) REFERENCES Employee(employee_name),
    FOREIGN KEY (manager_name) REFERENCES Employee(employee_name)
);

-- 2️⃣ Insert Sample Data

INSERT INTO Employee VALUES (1, 'Ravi', 'MG Road', 'Pune');
INSERT INTO Employee VALUES (2, 'Sneha', 'Baner', 'Pune');
INSERT INTO Employee VALUES (3, 'Amit', 'JM Road', 'Delhi');
INSERT INTO Employee VALUES (4, 'Priya', 'Karve Road', 'Mumbai');

INSERT INTO Company VALUES ('InfoSys', 'Pune');
INSERT INTO Company VALUES ('TechM', 'Mumbai');
INSERT INTO Company VALUES ('TCS', 'Delhi');

INSERT INTO Works VALUES ('Ravi', 'InfoSys', 8000);
INSERT INTO Works VALUES ('Sneha', 'InfoSys', 12000);
INSERT INTO Works VALUES ('Amit', 'TechM', 15000);
INSERT INTO Works VALUES ('Priya', 'TechM', 9000);

INSERT INTO Manages VALUES ('Ravi', 'Sneha');
INSERT INTO Manages VALUES ('Amit', 'Priya');

-- ✅ Verify inserted data
SELECT * FROM Employee;
SELECT * FROM Company;
SELECT * FROM Works;
SELECT * FROM Manages;

-- 3️⃣ Change the city of employees working with 'InfoSys' to 'Bangalore'

UPDATE Employee
SET city = 'Bangalore'
WHERE employee_name IN (
  SELECT employee_name
  FROM Works
  WHERE company_name = 'InfoSys'
);

-- ✅ Verify Update
SELECT * FROM Employee;

-- 4️⃣ Find names of employees earning more than average salary of their company

SELECT W.employee_name
FROM Works W
WHERE W.salary > (
  SELECT AVG(W2.salary)
  FROM Works W2
  WHERE W2.company_name = W.company_name
);

-- 5️⃣ Find employee details who work for 'TechM' and earn > 10000

SELECT E.employee_name, E.street, E.city
FROM Employee E
JOIN Works W ON E.employee_name = W.employee_name
WHERE W.company_name = 'TechM'
  AND W.salary > 10000;

-- 6️⃣ Rename table 'Manages' to 'Management'

ALTER TABLE Manages RENAME TO Management;

-- ✅ Verify Rename
SHOW TABLES;

-- 7️⃣ Create Simple and Unique Index on Employee table

-- Simple index on city
CREATE INDEX idx_city ON Employee(city);

-- Unique index on employee_name
CREATE UNIQUE INDEX idx_emp_name ON Employee(employee_name);

-- 8️⃣ Display Index Information

SHOW INDEX FROM Employee;